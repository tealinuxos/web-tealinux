---
interface Topic {
	id: string;
	title: string;
	slug: string;
	user: {
		name: string;
	};
	created_at: string;
	views: number;
	posts?: any[];
	is_pinned?: boolean;
	is_locked?: boolean;
	is_solved?: boolean;
	type?: string;
}

interface Props {
	topic: Topic;
	showCategory?: boolean;
	categoryName?: string;
	categorySlug?: string;
}

const { topic, showCategory = false, categoryName, categorySlug } = Astro.props;

const postCount = topic.posts?.length || 0;
const timeAgo = (date: string) => {
	const now = new Date();
	const past = new Date(date);
	const diffMs = now.getTime() - past.getTime();
	const diffMins = Math.floor(diffMs / 60000);
	const diffHours = Math.floor(diffMins / 60);
	const diffDays = Math.floor(diffHours / 24);
	
	if (diffMins < 60) return `${diffMins}m ago`;
	if (diffHours < 24) return `${diffHours}h ago`;
	return `${diffDays}d ago`;
};

// Thread type icons and colors
const typeConfig: Record<string, { icon: string; color: string }> = {
	bug: { icon: 'üêõ', color: 'text-red-400' },
	question: { icon: '‚ùì', color: 'text-blue-400' },
	discussion: { icon: 'üí¨', color: 'text-green-400' },
};

const config = typeConfig[topic.type || 'discussion'] || typeConfig.discussion;
---

<a 
	href={`/forum/topic/${topic.slug}`}
	class="flex items-start gap-4 p-4 rounded-lg border border-white/5 bg-gradient-to-br from-white/5 to-white/0 hover:border-[#54CD4C]/30 hover:bg-white/5 transition-all group"
>
	<!-- Type Icon -->
	<div class="shrink-0 text-2xl pt-1">
		{config.icon}
	</div>

	<!-- Content -->
	<div class="flex-1 min-w-0">
		<!-- Status Badges -->
		<div class="flex items-center gap-2 mb-1">
			{topic.is_pinned && (
				<span class="text-[#54CD4C] text-xs" title="Pinned">üìå</span>
			)}
			{topic.is_locked && (
				<span class="text-yellow-400 text-xs" title="Locked">üîí</span>
			)}
			{topic.is_solved && (
				<span class="text-green-400 text-xs" title="Solved">‚úÖ</span>
			)}
		</div>

		<!-- Title -->
		<h3 class="text-base font-bold text-white group-hover:text-[#54CD4C] transition-colors mb-1 line-clamp-2">
			{topic.title}
		</h3>

		<!-- Metadata -->
		<div class="flex items-center gap-3 text-xs text-slate-400">
			<span class="flex items-center gap-1">
				<span class="w-5 h-5 rounded-full bg-[#54CD4C]/20 flex items-center justify-center text-[#54CD4C] text-[10px] font-bold">
					{topic.user.name.charAt(0).toUpperCase()}
				</span>
				{topic.user.name}
			</span>
			<span>‚Ä¢</span>
			<span>{timeAgo(topic.created_at)}</span>
			{showCategory && categoryName && (
				<>
					<span>‚Ä¢</span>
					<a href={`/forum/category/${categorySlug}`} class="hover:text-[#54CD4C]" onclick="event.stopPropagation()">
						{categoryName}
					</a>
				</>
			)}
		</div>
	</div>

	<!-- Stats -->
	<div class="shrink-0 flex flex-col items-end gap-1 text-xs">
		<div class="flex items-center gap-3 text-slate-400">
			<span class="flex items-center gap-1" title="Views">
				<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
				</svg>
				{topic.views}
			</span>
			<span class="flex items-center gap-1 font-semibold text-[#54CD4C]" title="Replies">
				<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
				</svg>
				{postCount}
			</span>
		</div>
	</div>
</a>
